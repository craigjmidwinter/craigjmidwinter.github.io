<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://s3.us-west-2.amazonaws.com/mid-midwinter.cc/images/BJWTz95Tf.png"/><link rel="stylesheet" href="/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/craigjmidwinter.github.io/_next/static/chunks/webpack-05a4c90833827c02.js"/><script src="/craigjmidwinter.github.io/_next/static/chunks/4bd1b696-d31891ed15a5103e.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/517-2e9372f9ab95c04e.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/main-app-3b8a8eba0304deb0.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/285-46291424471f6717.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/app/layout-7d366822714c55bb.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/ee560e2c-c5c28398d0153d35.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/977-4f350745d400d589.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/173-52b2b489d82616e2.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/590-97f4dc9b90039a27.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/app/blog/%5Bslug%5D/page-ac15a53f2a627631.js" async=""></script><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><title>Craig Midwinter - Personal Website</title><meta name="description" content="Welcome to my personal website. Check out my resume, GitHub, LinkedIn, podcast, and blog posts."/><link rel="icon" href="/craigjmidwinter.github.io/favicon.ico" type="image/x-icon" sizes="16x16"/><link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet"/><script src="/craigjmidwinter.github.io/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script><style data-styled="" data-styled-version="6.1.15">.cMMXFN{background:rgba(0, 0, 20, 0.9);padding:1.5rem 2rem;border-bottom:2px solid #0ff;box-shadow:0 0 25px rgba(0, 255, 255, 0.3);position:relative;font-family:'Press Start 2P',monospace;backdrop-filter:blur(5px);}/*!sc*/
data-styled.g1[id="sc-FEMpB"]{content:"cMMXFN,"}/*!sc*/
.kIaxle{list-style:none;display:flex;gap:2rem;margin:0;padding:0;justify-content:center;}/*!sc*/
data-styled.g2[id="sc-gjcoXW"]{content:"kIaxle,"}/*!sc*/
.iGNEod{position:relative;}/*!sc*/
.iGNEod a{color:#0ff;text-decoration:none;padding:0.5rem 1rem;transition:all 0.3s ease;position:relative;}/*!sc*/
.iGNEod a:hover{color:#f0f;animation:cjwSKm 0.3s infinite;}/*!sc*/
.iGNEod a:hover::before{content:">";position:absolute;left:-1.2em;filter:drop-shadow(0 0 2px #f0f);}/*!sc*/
.iGNEod a:hover::after{content:"_";margin-left:0.5rem;}/*!sc*/
data-styled.g3[id="sc-dVBluf"]{content:"iGNEod,"}/*!sc*/
@keyframes cjwSKm{0%{text-shadow:2px 2px #0ff,-2px -2px #f0f;}25%{text-shadow:-2px 2px #0ff,2px -2px #f0f;}50%{text-shadow:2px -2px #0ff,-2px 2px #f0f;}75%{text-shadow:-2px -2px #0ff,2px 2px #f0f;}100%{text-shadow:2px 2px #0ff,-2px -2px #f0f;}}/*!sc*/
data-styled.g11[id="sc-keyframes-cjwSKm"]{content:"cjwSKm,"}/*!sc*/
.jJIuNk{position:fixed;top:0;left:0;width:100vw;height:100vh;object-fit:cover;z-index:-2;}/*!sc*/
data-styled.g12[id="sc-cMqPwU"]{content:"jJIuNk,"}/*!sc*/
.hNzkKj{max-width:800px;margin:2rem auto;padding:2rem;background:#000;color:#0f0;font-family:'IBM Plex Mono',monospace;line-height:1.6;border:2px solid #0f0;box-shadow:0 0 20px rgba(0, 255, 0, 0.5);position:relative;overflow:hidden;}/*!sc*/
data-styled.g13[id="sc-jUkaYT"]{content:"hNzkKj,"}/*!sc*/
.dYLfrY{background:rgba(0, 0, 0, 0.7);color:#ff0;border:1px solid #f0f;padding:1rem;margin-bottom:1rem;text-align:center;font-size:0.85rem;line-height:1.4;}/*!sc*/
.dYLfrY strong{color:#f0f;}/*!sc*/
data-styled.g14[id="sc-deSjom"]{content:"dYLfrY,"}/*!sc*/
.goaCnt{margin-bottom:1rem;}/*!sc*/
.goaCnt h1{font-size:1.5rem;margin-bottom:1rem;color:#0f0;}/*!sc*/
.goaCnt p{color:#0f0;opacity:0.9;margin:0;}/*!sc*/
data-styled.g15[id="sc-jHswkR"]{content:"goaCnt,"}/*!sc*/
.hRjXcY{background:rgba(0, 255, 0, 0.1);padding:1rem;border:1px solid #0f0;position:relative;margin:1.5rem 0;}/*!sc*/
data-styled.g17[id="sc-jZTQcj"]{content:"hRjXcY,"}/*!sc*/
.bHcmTX{position:absolute;top:5px;right:5px;background:transparent;border:1px solid #0f0;color:#0f0;padding:0.3rem 0.5rem;cursor:pointer;font-size:0.8rem;display:flex;align-items:center;gap:5px;}/*!sc*/
.bHcmTX:hover{background:#0f0;color:#000;}/*!sc*/
data-styled.g18[id="sc-dkBYrC"]{content:"bHcmTX,"}/*!sc*/
.eIsTfe{display:flex;justify-content:center;margin:1rem auto;text-align:center;}/*!sc*/
.eIsTfe img{max-width:100%;height:auto;border:1px solid #0f0;box-shadow:0 0 10px rgba(0, 255, 0, 0.3);}/*!sc*/
data-styled.g19[id="sc-kXOizl"]{content:"eIsTfe,"}/*!sc*/
</style></head><body><div id="root"><video autoPlay="" loop="" muted="" class="sc-cMqPwU jJIuNk"><source src="/outrun-waves_1.webm" type="video/webm"/></video><nav class="sc-FEMpB cMMXFN"><ul class="sc-gjcoXW kIaxle"><li class="sc-dVBluf iGNEod"><a href="/craigjmidwinter.github.io/blog/">BLOG HOME</a></li><li class="sc-dVBluf iGNEod"><a href="/craigjmidwinter.github.io">ABOUT CRAIG</a></li></ul></nav><div class="sc-jUkaYT hNzkKj"><div class="sc-jHswkR goaCnt"><p>2018-05-04</p><h1>The simple guide to Telegram&#x27;s custom inline keyboard</h1></div><div class="sc-deSjom dYLfrY"><p><strong>Note:</strong> This blog is an archive. Some content may be out of date, and images may be broken or missing. If you find an issue or have a question, please email <strong>craig.j.midwinter@gmail.com</strong>.</p></div><p><em>Note: If you&#x27;d like to see how this is implemented with Node-RED instead, <a href="https://midwinter.cc/post/telegram-keyboard-and-callbacks-in-home-assistant-with-node-red_r1Fa56ZRz/#top">check this post</a>.</em></p>
<p>A while ago I made <a href="https://midwinter.cc/post/my-house-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant_SJY1zsc0W/">this post</a> about creating an automation and Home Assistant integration to allow my house to order pizza for me. In the months since, I’ve noticed it referenced on a few occasions when people have been looking for more information on how to use the inline keyboard functionality in conjunction with the Telegram callbacks in order to create an actionable notification in Home Assistant.
<div class="sc-kXOizl eIsTfe"><img alt="" src="https://s3.us-west-2.amazonaws.com/mid-midwinter.cc/images/BJWTz95Tf.png"/></div>
Since that post is a bit long and only partially focuses on that functionality, I thought I’d cut the bullshit and make a quick post that focuses on it. If anyone has questions about this, feel free to leave a comment and I’ll try to answer. I’ll also try and keep this page updated with the answers to any questions that come up over time.</p>
<p>This post makes the assumption that you are familiar with the basic structure for defining automations in Home Assistant. It also makes the assumption that you have added the telegram bot to your configuration by following the instructions for either the <a href="https://www.home-assistant.io/components/telegram_bot.webhooks/">webhook method</a> or the <a href="https://www.home-assistant.io/components/telegram_bot.polling/">polling method</a>.</p>
<p>I’ll stick with the original example since it is really straight forward. At its simplest, using the Telegram inline keyboard and the Telegram callback really only requires two automations in Home Assistant-- I think the functionality is better demonstrated using three automations (one for your prompt and two answers), but there really isn&#x27;t any practical limit to how many you can have!</p>
<p>The first is your prompt, this is going to be your initial trigger automation. This automation is what sends your initial message on Telegram with your options. It will look something like this--</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">alias</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;Want pizza?&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">hide_entity</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;font-weight:bold">true</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">trigger</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">platform</span><span class="token token" style="color:#ccc">:</span><span> time
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">at</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;18:30:00&#x27;</span><span>    
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">condition</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">condition</span><span class="token token" style="color:#ccc">:</span><span> state
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">entity_id</span><span class="token token" style="color:#ccc">:</span><span> device_tracker.craig_craig
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">state</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;home&#x27;</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">condition</span><span class="token token" style="color:#ccc">:</span><span> state
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">entity_id</span><span class="token token" style="color:#ccc">:</span><span> device_tracker.jess_iphone
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">state</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;not_home&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">action</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> telegram_bot.send_message
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data_template</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">title</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;Want pizza?&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">target</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#e2777a">123456789</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">message</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;You look like you are home alone. Should I order you a pizza?&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">inline_keyboard</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>              </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token" style="color:#f87c32">&quot;Gimme Pizza:/gimmepizza&quot;</span><span>
</span><span>              </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token" style="color:#f87c32">&quot;No thanks:/nopizza&quot;</span></code></div></div></pre>
<p>The trigger and condition portions of this should look fairly familiar to you, you’ve probably got a bunch of automations that look like this in your current setup. The interesting bit is the action-- we’re calling the telegram_bot.send_message service and then using a data_template to define the message. Most of it is pretty self explanatory, the target field is the user_id and the message and title fields are the main contents of your message. The interesting part about this is the inline_keyboard field. This is where you set up your buttons!</p>
<p>Each button consists of two parts, the message and the payload. The two parts are separated by a colon with the message that your user sees in the message coming before the colon and the payload that gets sent back to Home Assistant. The payload is going to be a special command that you make up. It has got to start with a slash and I don’t think it can contain any spaces. This special command is what we will use to distinguish ‘Gimme Pizza’ from ‘No Thanks’.</p>
<p>This payload command can be reused in other prompt-like telegram message automations if you want to be able to trigger the same answer automation in a different combination of buttons in another context, or if you want to change the message side in a different context.</p>
<p>Now that we are able to send these messages from Home Assistant to our Telegram users, we need to define a way to handle those commands we’ve got coming in!</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">alias</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;No pizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">hide_entity</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;font-weight:bold">true</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">trigger</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">platform</span><span class="token token" style="color:#ccc">:</span><span> event
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_type</span><span class="token token" style="color:#ccc">:</span><span> telegram_callback
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_data</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;/nopizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">action</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> telegram_bot.answer_callback_query
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data_template</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">callback_query_id</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;{{ trigger.event.data.id }}&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">message</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;Ok, no pizza then&#x27;</span><span>
</span>    
<span>    </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">alias</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;gimme pizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">hide_entity</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;font-weight:bold">true</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">trigger</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">platform</span><span class="token token" style="color:#ccc">:</span><span> event
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_type</span><span class="token token" style="color:#ccc">:</span><span> telegram_callback
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_data</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;/gimmepizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">action</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> telegram_bot.answer_callback_query
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data_template</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">callback_query_id</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;{{ trigger.event.data.id }}&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">message</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;PIZZA TIME&#x27;</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> dominos.order
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">order_entity_id</span><span class="token token" style="color:#ccc">:</span><span> dominos.medium_pan</span></code></div></div></pre>
<p>As you can see we’ve got one automation for each answer. Both automations are triggered using the built-in event platform, and the same telegram_callback event_type, the difference is that we define different event_data for them, each automation matching the payload for the corresponding button!</p>
<p>We can trigger whatever we want in these automations-- In both of these cases we are using the telegram_bot.answer_callback_query service to provide the user with some feedback just to say that we received the message. This uses trigger.event within a template in order to use some of the information from the triggering event in the action. In this case, we are getting the id field and using it in the callback_query_id to tell the telegram_bot.answer_callback_query</p>
<p>service which event we are replying to and then defining a message.</p>
<p>My wife and I don’t actually really use Telegram at all day-to-day, instead we usually use Facebook Messenger for text communication. So for me, getting notifications on Telegram is not tremendously practical. I’ve actually just recently modified the Facebook Messenger notification platform in Home Assistant to allow for the sending of messages like this. I’ve created this PR to have that code added into the core Home Assistant project, so that should be available in the near future. I’ll try to remember to make a post about it when it gets merged in!</p>
<p>Hopefully this broke things down a bit, and please don’t hesitate to leave any questions you might have as comments and I’ll do my best to address them and keep this post up to date!</p></div></div><script src="/craigjmidwinter.github.io/_next/static/chunks/webpack-05a4c90833827c02.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[93812,[\"285\",\"static/chunks/285-46291424471f6717.js\",\"177\",\"static/chunks/app/layout-7d366822714c55bb.js\"],\"default\"]\n3:I[15244,[],\"\"]\n4:I[43866,[],\"\"]\n6:I[86213,[],\"OutletBoundary\"]\n8:I[86213,[],\"MetadataBoundary\"]\na:I[86213,[],\"ViewportBoundary\"]\nc:I[34835,[],\"\"]\n:HL[\"/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"cIo-wtig2jZi9dufmWdDw\",\"p\":\"/craigjmidwinter.github.io\",\"c\":[\"\",\"blog\",\"2018-05-the-simple-guide-to-creating-actionable-notifications-in-home-assistant-using-telegrams-custom-inline-keyboard-and-telegram_callbacks\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"2018-05-the-simple-guide-to-creating-actionable-notifications-in-home-assistant-using-telegrams-custom-inline-keyboard-and-telegram_callbacks\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Press+Start+2P\u0026display=swap\",\"rel\":\"stylesheet\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"div\",null,{\"id\":\"root\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"2018-05-the-simple-guide-to-creating-actionable-notifications-in-home-assistant-using-telegrams-custom-inline-keyboard-and-telegram_callbacks\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":\"$L7\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"uUdkIJw8V8Y5jZylXvtnw\",{\"children\":[[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$c\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:I[86880,[\"844\",\"static/chunks/ee560e2c-c5c28398d0153d35.js\",\"285\",\"static/chunks/285-46291424471f6717.js\",\"977\",\"static/chunks/977-4f350745d400d589.js\",\"173\",\"static/chunks/173-52b2b489d82616e2.js\",\"590\",\"static/chunks/590-97f4dc9b90039a27.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-ac15a53f2a627631.js\"],\"default\"]\ne:T1a65,"])</script><script>self.__next_f.push([1,"\n*Note: If you'd like to see how this is implemented with Node-RED instead, [check this post](https://midwinter.cc/post/telegram-keyboard-and-callbacks-in-home-assistant-with-node-red_r1Fa56ZRz/#top).*\n\nA while ago I made [this post](https://midwinter.cc/post/my-house-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant_SJY1zsc0W/) about creating an automation and Home Assistant integration to allow my house to order pizza for me. In the months since, I’ve noticed it referenced on a few occasions when people have been looking for more information on how to use the inline keyboard functionality in conjunction with the Telegram callbacks in order to create an actionable notification in Home Assistant.\n![](https://s3.us-west-2.amazonaws.com/mid-midwinter.cc/images/BJWTz95Tf.png)\nSince that post is a bit long and only partially focuses on that functionality, I thought I’d cut the bullshit and make a quick post that focuses on it. If anyone has questions about this, feel free to leave a comment and I’ll try to answer. I’ll also try and keep this page updated with the answers to any questions that come up over time.\n\nThis post makes the assumption that you are familiar with the basic structure for defining automations in Home Assistant. It also makes the assumption that you have added the telegram bot to your configuration by following the instructions for either the [webhook method](https://www.home-assistant.io/components/telegram_bot.webhooks/) or the [polling method](https://www.home-assistant.io/components/telegram_bot.polling/).\n\nI’ll stick with the original example since it is really straight forward. At its simplest, using the Telegram inline keyboard and the Telegram callback really only requires two automations in Home Assistant-- I think the functionality is better demonstrated using three automations (one for your prompt and two answers), but there really isn't any practical limit to how many you can have!\n\nThe first is your prompt, this is going to be your initial trigger automation. This automation is what sends your initial message on Telegram with your options. It will look something like this--\n\n```yaml\n    - alias: 'Want pizza?'\n      hide_entity: true\n      trigger:\n        platform: time\n        at: '18:30:00'    \n      condition:\n        - condition: state\n          entity_id: device_tracker.craig_craig\n          state: 'home'\n        - condition: state\n          entity_id: device_tracker.jess_iphone\n          state: 'not_home'\n      action:\n        - service: telegram_bot.send_message\n          data_template:\n            title: 'Want pizza?'\n            target: 123456789\n            message: 'You look like you are home alone. Should I order you a pizza?'\n            inline_keyboard:\n              - \"Gimme Pizza:/gimmepizza\"\n              - \"No thanks:/nopizza\"\n```\n\nThe trigger and condition portions of this should look fairly familiar to you, you’ve probably got a bunch of automations that look like this in your current setup. The interesting bit is the action-- we’re calling the telegram_bot.send_message service and then using a data_template to define the message. Most of it is pretty self explanatory, the target field is the user_id and the message and title fields are the main contents of your message. The interesting part about this is the inline_keyboard field. This is where you set up your buttons!\n\nEach button consists of two parts, the message and the payload. The two parts are separated by a colon with the message that your user sees in the message coming before the colon and the payload that gets sent back to Home Assistant. The payload is going to be a special command that you make up. It has got to start with a slash and I don’t think it can contain any spaces. This special command is what we will use to distinguish ‘Gimme Pizza’ from ‘No Thanks’.\n\nThis payload command can be reused in other prompt-like telegram message automations if you want to be able to trigger the same answer automation in a different combination of buttons in another context, or if you want to change the message side in a different context.\n\nNow that we are able to send these messages from Home Assistant to our Telegram users, we need to define a way to handle those commands we’ve got coming in!\n\n```yaml\n    - alias: 'No pizza'\n      hide_entity: true\n      trigger:\n        platform: event\n        event_type: telegram_callback\n        event_data:\n          data: '/nopizza'\n      action:\n        - service: telegram_bot.answer_callback_query\n          data_template:\n            callback_query_id: '{{ trigger.event.data.id }}'\n            message: 'Ok, no pizza then'\n    \n    - alias: 'gimme pizza'\n      hide_entity: true\n      trigger:\n        platform: event\n        event_type: telegram_callback\n        event_data:\n          data: '/gimmepizza'\n      action:\n        - service: telegram_bot.answer_callback_query\n          data_template:\n            callback_query_id: '{{ trigger.event.data.id }}'\n            message: 'PIZZA TIME'\n        - service: dominos.order\n          data:\n            order_entity_id: dominos.medium_pan\n```\n\nAs you can see we’ve got one automation for each answer. Both automations are triggered using the built-in event platform, and the same telegram_callback event_type, the difference is that we define different event_data for them, each automation matching the payload for the corresponding button!\n\nWe can trigger whatever we want in these automations-- In both of these cases we are using the telegram_bot.answer_callback_query service to provide the user with some feedback just to say that we received the message. This uses trigger.event within a template in order to use some of the information from the triggering event in the action. In this case, we are getting the id field and using it in the callback_query_id to tell the telegram_bot.answer_callback_query\n\nservice which event we are replying to and then defining a message.\n\nMy wife and I don’t actually really use Telegram at all day-to-day, instead we usually use Facebook Messenger for text communication. So for me, getting notifications on Telegram is not tremendously practical. I’ve actually just recently modified the Facebook Messenger notification platform in Home Assistant to allow for the sending of messages like this. I’ve created this PR to have that code added into the core Home Assistant project, so that should be available in the near future. I’ll try to remember to make a post about it when it gets merged in!\n\nHopefully this broke things down a bit, and please don’t hesitate to leave any questions you might have as comments and I’ll do my best to address them and keep this post up to date!\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$Ld\",null,{\"post\":{\"slug\":\"2018-05-the-simple-guide-to-creating-actionable-notifications-in-home-assistant-using-telegrams-custom-inline-keyboard-and-telegram_callbacks\",\"title\":\"The simple guide to Telegram's custom inline keyboard\",\"date_published\":\"$D2018-05-04T22:27:00.000Z\",\"date_updated\":\"$D2018-12-11T22:42:45.000Z\",\"tags\":\"Home Assistant, Telegram, YAML, Home Automation\",\"cover_image\":\"\",\"content\":\"$e\"}}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Craig Midwinter - Personal Website\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Welcome to my personal website. Check out my resume, GitHub, LinkedIn, podcast, and blog posts.\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/craigjmidwinter.github.io/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n"])</script><script>self.__next_f.push([1,"7:null\n"])</script></body></html>