<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://s3.us-west-2.amazonaws.com/mid-midwinter.cc/images/ryt1RoiAZ.png"/><link rel="stylesheet" href="/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/craigjmidwinter.github.io/_next/static/chunks/webpack-05a4c90833827c02.js"/><script src="/craigjmidwinter.github.io/_next/static/chunks/4bd1b696-d31891ed15a5103e.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/517-2e9372f9ab95c04e.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/main-app-3b8a8eba0304deb0.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/285-46291424471f6717.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/app/layout-7d366822714c55bb.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/ee560e2c-c5c28398d0153d35.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/977-4f350745d400d589.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/173-52b2b489d82616e2.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/590-97f4dc9b90039a27.js" async=""></script><script src="/craigjmidwinter.github.io/_next/static/chunks/app/blog/%5Bslug%5D/page-ac15a53f2a627631.js" async=""></script><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><title>Craig Midwinter - Personal Website</title><meta name="description" content="Welcome to my personal website. Check out my resume, GitHub, LinkedIn, podcast, and blog posts."/><link rel="icon" href="/craigjmidwinter.github.io/favicon.ico" type="image/x-icon" sizes="16x16"/><link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet"/><script src="/craigjmidwinter.github.io/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script><style data-styled="" data-styled-version="6.1.15">.cMMXFN{background:rgba(0, 0, 20, 0.9);padding:1.5rem 2rem;border-bottom:2px solid #0ff;box-shadow:0 0 25px rgba(0, 255, 255, 0.3);position:relative;font-family:'Press Start 2P',monospace;backdrop-filter:blur(5px);}/*!sc*/
data-styled.g1[id="sc-FEMpB"]{content:"cMMXFN,"}/*!sc*/
.kIaxle{list-style:none;display:flex;gap:2rem;margin:0;padding:0;justify-content:center;}/*!sc*/
data-styled.g2[id="sc-gjcoXW"]{content:"kIaxle,"}/*!sc*/
.iGNEod{position:relative;}/*!sc*/
.iGNEod a{color:#0ff;text-decoration:none;padding:0.5rem 1rem;transition:all 0.3s ease;position:relative;}/*!sc*/
.iGNEod a:hover{color:#f0f;animation:cjwSKm 0.3s infinite;}/*!sc*/
.iGNEod a:hover::before{content:">";position:absolute;left:-1.2em;filter:drop-shadow(0 0 2px #f0f);}/*!sc*/
.iGNEod a:hover::after{content:"_";margin-left:0.5rem;}/*!sc*/
data-styled.g3[id="sc-dVBluf"]{content:"iGNEod,"}/*!sc*/
@keyframes cjwSKm{0%{text-shadow:2px 2px #0ff,-2px -2px #f0f;}25%{text-shadow:-2px 2px #0ff,2px -2px #f0f;}50%{text-shadow:2px -2px #0ff,-2px 2px #f0f;}75%{text-shadow:-2px -2px #0ff,2px 2px #f0f;}100%{text-shadow:2px 2px #0ff,-2px -2px #f0f;}}/*!sc*/
data-styled.g11[id="sc-keyframes-cjwSKm"]{content:"cjwSKm,"}/*!sc*/
.jJIuNk{position:fixed;top:0;left:0;width:100vw;height:100vh;object-fit:cover;z-index:-2;}/*!sc*/
data-styled.g12[id="sc-cMqPwU"]{content:"jJIuNk,"}/*!sc*/
.hNzkKj{max-width:800px;margin:2rem auto;padding:2rem;background:#000;color:#0f0;font-family:'IBM Plex Mono',monospace;line-height:1.6;border:2px solid #0f0;box-shadow:0 0 20px rgba(0, 255, 0, 0.5);position:relative;overflow:hidden;}/*!sc*/
data-styled.g13[id="sc-jUkaYT"]{content:"hNzkKj,"}/*!sc*/
.dYLfrY{background:rgba(0, 0, 0, 0.7);color:#ff0;border:1px solid #f0f;padding:1rem;margin-bottom:1rem;text-align:center;font-size:0.85rem;line-height:1.4;}/*!sc*/
.dYLfrY strong{color:#f0f;}/*!sc*/
data-styled.g14[id="sc-deSjom"]{content:"dYLfrY,"}/*!sc*/
.goaCnt{margin-bottom:1rem;}/*!sc*/
.goaCnt h1{font-size:1.5rem;margin-bottom:1rem;color:#0f0;}/*!sc*/
.goaCnt p{color:#0f0;opacity:0.9;margin:0;}/*!sc*/
data-styled.g15[id="sc-jHswkR"]{content:"goaCnt,"}/*!sc*/
.hRjXcY{background:rgba(0, 255, 0, 0.1);padding:1rem;border:1px solid #0f0;position:relative;margin:1.5rem 0;}/*!sc*/
data-styled.g17[id="sc-jZTQcj"]{content:"hRjXcY,"}/*!sc*/
.bHcmTX{position:absolute;top:5px;right:5px;background:transparent;border:1px solid #0f0;color:#0f0;padding:0.3rem 0.5rem;cursor:pointer;font-size:0.8rem;display:flex;align-items:center;gap:5px;}/*!sc*/
.bHcmTX:hover{background:#0f0;color:#000;}/*!sc*/
data-styled.g18[id="sc-dkBYrC"]{content:"bHcmTX,"}/*!sc*/
.eIsTfe{display:flex;justify-content:center;margin:1rem auto;text-align:center;}/*!sc*/
.eIsTfe img{max-width:100%;height:auto;border:1px solid #0f0;box-shadow:0 0 10px rgba(0, 255, 0, 0.3);}/*!sc*/
data-styled.g19[id="sc-kXOizl"]{content:"eIsTfe,"}/*!sc*/
</style></head><body><div id="root"><video autoPlay="" loop="" muted="" class="sc-cMqPwU jJIuNk"><source src="/outrun-waves_1.webm" type="video/webm"/></video><nav class="sc-FEMpB cMMXFN"><ul class="sc-gjcoXW kIaxle"><li class="sc-dVBluf iGNEod"><a href="/craigjmidwinter.github.io/blog/">BLOG HOME</a></li><li class="sc-dVBluf iGNEod"><a href="/craigjmidwinter.github.io">ABOUT CRAIG</a></li></ul></nav><div class="sc-jUkaYT hNzkKj"><div class="sc-jHswkR goaCnt"><p>2018-05-04</p><h1>My house automatically orders pizza for me – Dominos Pizza automation using Home Assistant.</h1></div><div class="sc-deSjom dYLfrY"><p><strong>Note:</strong> This blog is an archive. Some content may be out of date, and images may be broken or missing. If you find an issue or have a question, please email <strong>craig.j.midwinter@gmail.com</strong>.</p></div><p><em><strong>Note: If you were linked here to see my telegram keyboard/callback implementation, <a href="https://midwinter.cc/post/the-simple-guide-to-creating-actionable-notifications-in-home-assistant-using-telegram-s-custom-inline-keyboard-and-telegram_callbacks_SJiJnOqpG/">I&#x27;ve got a more complete example here</a></strong></em></p>
<p>A good automation takes an action that you regularly perform and does it for you-- a great automation amplifies your laziest personality traits and takes them to new depths.</p>
<p>Let me be clear, my wife and I share cooking duties, but when I&#x27;m on my own I just really don’t care about cooking for
myself (also just really like pizza). That’s why when I’m home on my own and my wife is out for the evening, I’ll often
just order some pizza for myself.</p>
<p>Lazy? Sure, but it could be lazier-- let’s automate it!</p>
<p>Domino’s Pizza is my go-to pizza place, and they’ve got a pretty good online ordering system. While their API isn’t publically documented, their web-app is pretty fully featured and by opening up the dev-tools on your browser you can take a look at the requests to see what end-points do what.</p>
<p>Now, compiling all of this information and assembling a client library would be a somewhat tedious and painstaking job. I was very pleased to find that someone had already created this client library for the US Domino’s. The American web app is pretty much identical to the Canadian one, just on a different domain, so I just needed to make a few small changes to allow for multiple countries with different endpoints. After that, it was just a matter of creating the Home Assistant service.</p>
<p>Enough about how it’s made-- how do I use it?</p>
<p>Warning: I made this in a day during a hack-day at the office, so it’s pretty basic and a little rough around the edges.</p>
<p>Potential contributors: The client library supports the ability for toppings and coupons, but at the moment the Home Assistant component does not. I’m hoping to get around to adding this in, but it’s not super high on my priority list right now. Also, the current process for getting product codes isn’t the most user friendly thing in the world. I’m not exactly a front-end wizard, so if you’d like to make a panel or something to display this instead of the log dump, that would be awesome!</p>
<p>Right now, this isn’t yet in the core Home Assistant install, but there is
a <a href="https://github.com/home-assistant/home-assistant/pull/10379">Pull Request</a> made, so it should hopefully be available
in the next release, or if you are impatient you can install the library client library via pip (pizzapi) and
then <a href="https://gist.github.com/craigjmidwinter/8548e572b8ee77decd83983e39b887c9">grab the component from this gist</a> and
add it to your custom components.</p>
<p>To get the component configured, you are going to need to add your information to your configuration.yml like so:</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">dominos</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">country_code</span><span class="token token" style="color:#ccc">:</span><span> ca
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">first_name</span><span class="token token" style="color:#ccc">:</span><span> Justin
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">last_name</span><span class="token token" style="color:#ccc">:</span><span> Trudeau
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">email</span><span class="token token" style="color:#ccc">:</span><span> justin.trudeau@parl.gc.ca
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">phone</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#e2777a">6139950253</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">address</span><span class="token token" style="color:#ccc">:</span><span> 24 Sussex Dr</span><span class="token token" style="color:#ccc">,</span><span> Ottawa</span><span class="token token" style="color:#ccc">,</span><span> ON</span><span class="token token" style="color:#ccc">,</span><span> K1M1M4
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">show_menu</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#e2777a">1</span></code></div></div></pre>
<p>If you are wanting to order anything, you are going to need to define some order entities! These are really simple items that live under the orders key. Right now, they just consist of a name and a list of codes, like so:</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">orders</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">name</span><span class="token token" style="color:#ccc">:</span><span> Medium Pan
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">codes</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>          </span><span class="token token" style="color:#ccc">-</span><span> P12IPAZA</span></code></div></div></pre>
<p>How do you find these order codes? Well, at the moment, it’s not exactly pretty. Currently, the best way to see the codes for the products at your nearest Dominos is to add show_menu: 1 into your config. With that set, when Home Assistant starts and the component loads, you should see a bunch of products and variants in a panel in Home Assistant. The variants represent different sizes and crust choices for the most part. It takes a bit of guesswork in order to decipher what each code represents, but for the most part, you can look at the online menu of your local dominos and compare the offerings.</p>
<p>Or if you are comfortable using a browser’s dev tools, you can do what I did instead and use the Dominos web app to put together an order, and then before you submit the order, turn off your network connection, open up your browser’s dev tools, hit submit and inspect the payload for the order request and have a look at the codes that are sent.</p>
<p>So now that you have your order codes your full config, with your customer information and a few different orders will look like so:</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">dominos</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">country_code</span><span class="token token" style="color:#ccc">:</span><span> ca
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">first_name</span><span class="token token" style="color:#ccc">:</span><span> Justin
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">last_name</span><span class="token token" style="color:#ccc">:</span><span> Trudeau
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">email</span><span class="token token" style="color:#ccc">:</span><span> justin.trudeau@parl.gc.ca
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">phone</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#e2777a">6139950253</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">address</span><span class="token token" style="color:#ccc">:</span><span> 24 Sussex Dr</span><span class="token token" style="color:#ccc">,</span><span> Ottawa</span><span class="token token" style="color:#ccc">,</span><span> ON</span><span class="token token" style="color:#ccc">,</span><span> K1M1M4
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">show_menu</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#e2777a">1</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">orders</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>      </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">name</span><span class="token token" style="color:#ccc">:</span><span> Medium Pan
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">codes</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>          </span><span class="token token" style="color:#ccc">-</span><span> P12IPAZA</span></code></div></div></pre>
<p>With your config updated, restart Home Assistant and now you should be ready to order pizza in your scripts and automations! Let’s have a look at the one that I set up as an example--</p>
<p>Now, the automation that I have set up is a bit more complex than it needs to be.</p>
<p>If you just want to include a pizza order into a script that you run (for example, if you wanted to be able to be able to trigger a ‘movie night’ script that put your house into movie mode and ordered a pizza), you can just call the service and specify the order entity that you would like to use by adding something like this to the action on your automation and you are done:</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> dominos.order
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">order_entity_id</span><span class="token token" style="color:#ccc">:</span><span> dominos.medium_pan</span></code></div></div></pre>
<p>I want my pizza order to be event-based, (ie, at a certain time, if I’m the only one home), but I don’t really want it to happen every single time, I’d like to just be prompted and then have the order placed if I confirm it. For this to happen, I need some sort of actionable notification.</p>
<p>I decided to use Telegram for my notification platform for this since it supports actionable notifications using the custom keyboard feature, and it’s available on all the platforms that I use.</p>
<p>In order to accomplish this, I need to actually set up two separate automations (well, I set up three, but the third is not really necessary). Let’s take a look at the first one:</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">alias</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;Want pizza?&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">hide_entity</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;font-weight:bold">true</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">trigger</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">platform</span><span class="token token" style="color:#ccc">:</span><span> time
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">at</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;18:30:00&#x27;</span><span>    
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">condition</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">condition</span><span class="token token" style="color:#ccc">:</span><span> state
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">entity_id</span><span class="token token" style="color:#ccc">:</span><span> device_tracker.craig_craig
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">state</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;home&#x27;</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">condition</span><span class="token token" style="color:#ccc">:</span><span> state
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">entity_id</span><span class="token token" style="color:#ccc">:</span><span> device_tracker.jess_iphone
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">state</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;not_home&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">action</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> telegram_bot.send_message
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data_template</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">title</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;Want pizza?&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">target</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#e2777a">123456789</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">message</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;You look like you are home alone. Should I order you a pizza?&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">disable_notification</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;font-weight:bold">true</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">inline_keyboard</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>              </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token" style="color:#f87c32">&quot;Gimme Pizza:/gimmepizza&quot;</span><span>
</span><span>              </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token" style="color:#f87c32">&quot;No thanks:/nopizza&quot;</span></code></div></div></pre>
<p>The first automation triggers at 6:30pm if I am at home and my wife is not_home. She goes to the gym in the evening several times a week at this time and we eat a bit later on those days, so I avoid her being in the not_home state by creating a zone around the gym. When the condition is met, I get a telegram message sent to me that looks like this:
<div class="sc-kXOizl eIsTfe"><img alt="" src="https://s3.us-west-2.amazonaws.com/mid-midwinter.cc/images/ryt1RoiAZ.png"/></div>
The two options are buttons that basically just send back a command (defined in that inline keyboard bit) that we handle in a callback event. The automation for those callback event looks like this:</p>
<pre><div class="sc-jZTQcj hRjXcY"><button class="sc-dkBYrC bHcmTX"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg> Copy</button><div style="color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background-color:transparent !important;background-image:linear-gradient(to bottom, #2a2139 75%, #34294f)"><code class="language-yaml" style="white-space:pre;color:#f92aad;text-shadow:0 0 2px #100c0f, 0 0 5px #dc078e33, 0 0 10px #fff3;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">alias</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;No pizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">hide_entity</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;font-weight:bold">true</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">trigger</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">platform</span><span class="token token" style="color:#ccc">:</span><span> event
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_type</span><span class="token token" style="color:#ccc">:</span><span> telegram_callback
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_data</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;/nopizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">action</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> telegram_bot.answer_callback_query
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data_template</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">callback_query_id</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;{{ trigger.event.data.id }}&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">message</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;Ok, no pizza then&#x27;</span><span>
</span>    
<span>    </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">alias</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;gimme pizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">hide_entity</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575;font-weight:bold">true</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">trigger</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">platform</span><span class="token token" style="color:#ccc">:</span><span> event
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_type</span><span class="token token" style="color:#ccc">:</span><span> telegram_callback
</span><span>        </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">event_data</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;/gimmepizza&#x27;</span><span>
</span><span>      </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">action</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> telegram_bot.answer_callback_query
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data_template</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">callback_query_id</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;{{ trigger.event.data.id }}&#x27;</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">message</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#f87c32">&#x27;PIZZA TIME&#x27;</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">-</span><span> </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">service</span><span class="token token" style="color:#ccc">:</span><span> dominos.order
</span><span>          </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">data</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token key" style="color:#f4eee4;text-shadow:0 0 2px #393a33, 0 0 8px #f39f0575, 0 0 2px #f39f0575">order_entity_id</span><span class="token token" style="color:#ccc">:</span><span> dominos.medium_pan</span></code></div></div></pre>
<p>You can see I’ve got one that handles the no response and just gives some user feedback and then one that handles the yes response as well as calls our dominos service and specifies the order.</p>
<p>That inline keyboard is feature is not bound to just two options, so if I had a more adventurous palate, I could have this automation send me a variety of options for orders and let me select which one I want by handling each of the callback responses in a separate automation, but a medium pan pizza is good enough for me.</p></div></div><script src="/craigjmidwinter.github.io/_next/static/chunks/webpack-05a4c90833827c02.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[93812,[\"285\",\"static/chunks/285-46291424471f6717.js\",\"177\",\"static/chunks/app/layout-7d366822714c55bb.js\"],\"default\"]\n3:I[15244,[],\"\"]\n4:I[43866,[],\"\"]\n6:I[86213,[],\"OutletBoundary\"]\n8:I[86213,[],\"MetadataBoundary\"]\na:I[86213,[],\"ViewportBoundary\"]\nc:I[34835,[],\"\"]\n:HL[\"/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"-bacap1V3AiGvFOWYwHcm\",\"p\":\"/craigjmidwinter.github.io\",\"c\":[\"\",\"blog\",\"2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Press+Start+2P\u0026display=swap\",\"rel\":\"stylesheet\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"div\",null,{\"id\":\"root\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":\"$L7\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"XR1W2YOG4W3eox2ARRQgg\",{\"children\":[[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$c\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:I[86880,[\"844\",\"static/chunks/ee560e2c-c5c28398d0153d35.js\",\"285\",\"static/chunks/285-46291424471f6717.js\",\"977\",\"static/chunks/977-4f350745d400d589.js\",\"173\",\"static/chunks/173-52b2b489d82616e2.js\",\"590\",\"static/chunks/590-97f4dc9b90039a27.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-ac15a53f2a627631.js\"],\"default\"]\ne:T2309,"])</script><script>self.__next_f.push([1,"\n***Note: If you were linked here to see my telegram keyboard/callback implementation, [I've got a more complete example here](https://midwinter.cc/post/the-simple-guide-to-creating-actionable-notifications-in-home-assistant-using-telegram-s-custom-inline-keyboard-and-telegram_callbacks_SJiJnOqpG/)***\n\nA good automation takes an action that you regularly perform and does it for you-- a great automation amplifies your laziest personality traits and takes them to new depths.\n\nLet me be clear, my wife and I share cooking duties, but when I'm on my own I just really don’t care about cooking for\nmyself (also just really like pizza). That’s why when I’m home on my own and my wife is out for the evening, I’ll often\njust order some pizza for myself.\n\nLazy? Sure, but it could be lazier-- let’s automate it!\n\nDomino’s Pizza is my go-to pizza place, and they’ve got a pretty good online ordering system. While their API isn’t publically documented, their web-app is pretty fully featured and by opening up the dev-tools on your browser you can take a look at the requests to see what end-points do what.\n\nNow, compiling all of this information and assembling a client library would be a somewhat tedious and painstaking job. I was very pleased to find that someone had already created this client library for the US Domino’s. The American web app is pretty much identical to the Canadian one, just on a different domain, so I just needed to make a few small changes to allow for multiple countries with different endpoints. After that, it was just a matter of creating the Home Assistant service.\n\nEnough about how it’s made-- how do I use it?\n\nWarning: I made this in a day during a hack-day at the office, so it’s pretty basic and a little rough around the edges.\n\nPotential contributors: The client library supports the ability for toppings and coupons, but at the moment the Home Assistant component does not. I’m hoping to get around to adding this in, but it’s not super high on my priority list right now. Also, the current process for getting product codes isn’t the most user friendly thing in the world. I’m not exactly a front-end wizard, so if you’d like to make a panel or something to display this instead of the log dump, that would be awesome!\n\nRight now, this isn’t yet in the core Home Assistant install, but there is\na [Pull Request](https://github.com/home-assistant/home-assistant/pull/10379) made, so it should hopefully be available\nin the next release, or if you are impatient you can install the library client library via pip (pizzapi) and\nthen [grab the component from this gist](https://gist.github.com/craigjmidwinter/8548e572b8ee77decd83983e39b887c9) and\nadd it to your custom components.\n\nTo get the component configured, you are going to need to add your information to your configuration.yml like so:\n\n```yaml\n    dominos:\n      country_code: ca\n      first_name: Justin\n      last_name: Trudeau\n      email: justin.trudeau@parl.gc.ca\n      phone: 6139950253\n      address: 24 Sussex Dr, Ottawa, ON, K1M1M4\n      show_menu: 1\n```\n\nIf you are wanting to order anything, you are going to need to define some order entities! These are really simple items that live under the orders key. Right now, they just consist of a name and a list of codes, like so:\n\n```yaml\n      orders:\n      - name: Medium Pan\n        codes:\n          - P12IPAZA\n```\n\nHow do you find these order codes? Well, at the moment, it’s not exactly pretty. Currently, the best way to see the codes for the products at your nearest Dominos is to add show_menu: 1 into your config. With that set, when Home Assistant starts and the component loads, you should see a bunch of products and variants in a panel in Home Assistant. The variants represent different sizes and crust choices for the most part. It takes a bit of guesswork in order to decipher what each code represents, but for the most part, you can look at the online menu of your local dominos and compare the offerings.\n\nOr if you are comfortable using a browser’s dev tools, you can do what I did instead and use the Dominos web app to put together an order, and then before you submit the order, turn off your network connection, open up your browser’s dev tools, hit submit and inspect the payload for the order request and have a look at the codes that are sent.\n\nSo now that you have your order codes your full config, with your customer information and a few different orders will look like so:\n\n```yaml\n    dominos:\n      country_code: ca\n      first_name: Justin\n      last_name: Trudeau\n      email: justin.trudeau@parl.gc.ca\n      phone: 6139950253\n      address: 24 Sussex Dr, Ottawa, ON, K1M1M4\n      show_menu: 1\n      orders:\n      - name: Medium Pan\n        codes:\n          - P12IPAZA\n```\n\nWith your config updated, restart Home Assistant and now you should be ready to order pizza in your scripts and automations! Let’s have a look at the one that I set up as an example--\n\nNow, the automation that I have set up is a bit more complex than it needs to be.\n\nIf you just want to include a pizza order into a script that you run (for example, if you wanted to be able to be able to trigger a ‘movie night’ script that put your house into movie mode and ordered a pizza), you can just call the service and specify the order entity that you would like to use by adding something like this to the action on your automation and you are done:\n\n```yaml\n        - service: dominos.order\n          data:\n            order_entity_id: dominos.medium_pan\n```\n\nI want my pizza order to be event-based, (ie, at a certain time, if I’m the only one home), but I don’t really want it to happen every single time, I’d like to just be prompted and then have the order placed if I confirm it. For this to happen, I need some sort of actionable notification.\n\nI decided to use Telegram for my notification platform for this since it supports actionable notifications using the custom keyboard feature, and it’s available on all the platforms that I use.\n\nIn order to accomplish this, I need to actually set up two separate automations (well, I set up three, but the third is not really necessary). Let’s take a look at the first one:\n\n```yaml\n    - alias: 'Want pizza?'\n      hide_entity: true\n      trigger:\n        platform: time\n        at: '18:30:00'    \n      condition:\n        - condition: state\n          entity_id: device_tracker.craig_craig\n          state: 'home'\n        - condition: state\n          entity_id: device_tracker.jess_iphone\n          state: 'not_home'\n      action:\n        - service: telegram_bot.send_message\n          data_template:\n            title: 'Want pizza?'\n            target: 123456789\n            message: 'You look like you are home alone. Should I order you a pizza?'\n            disable_notification: true\n            inline_keyboard:\n              - \"Gimme Pizza:/gimmepizza\"\n              - \"No thanks:/nopizza\"\n```\n\nThe first automation triggers at 6:30pm if I am at home and my wife is not_home. She goes to the gym in the evening several times a week at this time and we eat a bit later on those days, so I avoid her being in the not_home state by creating a zone around the gym. When the condition is met, I get a telegram message sent to me that looks like this:\n![](https://s3.us-west-2.amazonaws.com/mid-midwinter.cc/images/ryt1RoiAZ.png)\nThe two options are buttons that basically just send back a command (defined in that inline keyboard bit) that we handle in a callback event. The automation for those callback event looks like this:\n\n```yaml\n    - alias: 'No pizza'\n      hide_entity: true\n      trigger:\n        platform: event\n        event_type: telegram_callback\n        event_data:\n          data: '/nopizza'\n      action:\n        - service: telegram_bot.answer_callback_query\n          data_template:\n            callback_query_id: '{{ trigger.event.data.id }}'\n            message: 'Ok, no pizza then'\n    \n    - alias: 'gimme pizza'\n      hide_entity: true\n      trigger:\n        platform: event\n        event_type: telegram_callback\n        event_data:\n          data: '/gimmepizza'\n      action:\n        - service: telegram_bot.answer_callback_query\n          data_template:\n            callback_query_id: '{{ trigger.event.data.id }}'\n            message: 'PIZZA TIME'\n        - service: dominos.order\n          data:\n            order_entity_id: dominos.medium_pan\n```\n\nYou can see I’ve got one that handles the no response and just gives some user feedback and then one that handles the yes response as well as calls our dominos service and specifies the order.\n\nThat inline keyboard is feature is not bound to just two options, so if I had a more adventurous palate, I could have this automation send me a variety of options for orders and let me select which one I want by handling each of the callback responses in a separate automation, but a medium pan pizza is good enough for me.\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$Ld\",null,{\"post\":{\"slug\":\"2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant\",\"title\":\"My house automatically orders pizza for me – Dominos Pizza automation using Home Assistant.\",\"date_published\":\"$D2018-05-04T22:17:00.000Z\",\"date_updated\":\"$D2018-12-14T03:59:33.000Z\",\"tags\":\"Home Assistant, YAML, Programming, Dominos, Home Automation, Telegram\",\"cover_image\":\"\",\"content\":\"$e\"}}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Craig Midwinter - Personal Website\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Welcome to my personal website. Check out my resume, GitHub, LinkedIn, podcast, and blog posts.\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/craigjmidwinter.github.io/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n"])</script><script>self.__next_f.push([1,"7:null\n"])</script></body></html>