1:"$Sreact.fragment"
2:I[93812,["285","static/chunks/285-46291424471f6717.js","177","static/chunks/app/layout-7d366822714c55bb.js"],"default"]
3:I[15244,[],""]
4:I[43866,[],""]
6:I[86213,[],"OutletBoundary"]
8:I[86213,[],"MetadataBoundary"]
a:I[86213,[],"ViewportBoundary"]
c:I[34835,[],""]
:HL["/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css","style"]
0:{"P":null,"b":"cIo-wtig2jZi9dufmWdDw","p":"/craigjmidwinter.github.io","c":["","blog","2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant",""],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/craigjmidwinter.github.io/_next/static/css/a2fe316cdd23b4ed.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","link",null,{"rel":"preconnect","href":"https://fonts.googleapis.com"}],["$","link",null,{"rel":"preconnect","href":"https://fonts.gstatic.com","crossOrigin":""}],["$","link",null,{"href":"https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap","rel":"stylesheet"}]]}],["$","body",null,{"children":["$","$L2",null,{"children":["$","div",null,{"id":"root","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",null,["$","$L6",null,{"children":"$L7"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","w8jhrAg8O1kxPeDbPNlVm",{"children":[["$","$L8",null,{"children":"$L9"}],["$","$La",null,{"children":"$Lb"}],null]}]]}],false]],"m":"$undefined","G":["$c","$undefined"],"s":false,"S":true}
d:I[86880,["844","static/chunks/ee560e2c-c5c28398d0153d35.js","285","static/chunks/285-46291424471f6717.js","977","static/chunks/977-4f350745d400d589.js","173","static/chunks/173-52b2b489d82616e2.js","590","static/chunks/590-97f4dc9b90039a27.js","953","static/chunks/app/blog/%5Bslug%5D/page-ac15a53f2a627631.js"],"default"]
e:T2309,
***Note: If you were linked here to see my telegram keyboard/callback implementation, [I've got a more complete example here](https://midwinter.cc/post/the-simple-guide-to-creating-actionable-notifications-in-home-assistant-using-telegram-s-custom-inline-keyboard-and-telegram_callbacks_SJiJnOqpG/)***

A good automation takes an action that you regularly perform and does it for you-- a great automation amplifies your laziest personality traits and takes them to new depths.

Let me be clear, my wife and I share cooking duties, but when I'm on my own I just really don’t care about cooking for
myself (also just really like pizza). That’s why when I’m home on my own and my wife is out for the evening, I’ll often
just order some pizza for myself.

Lazy? Sure, but it could be lazier-- let’s automate it!

Domino’s Pizza is my go-to pizza place, and they’ve got a pretty good online ordering system. While their API isn’t publically documented, their web-app is pretty fully featured and by opening up the dev-tools on your browser you can take a look at the requests to see what end-points do what.

Now, compiling all of this information and assembling a client library would be a somewhat tedious and painstaking job. I was very pleased to find that someone had already created this client library for the US Domino’s. The American web app is pretty much identical to the Canadian one, just on a different domain, so I just needed to make a few small changes to allow for multiple countries with different endpoints. After that, it was just a matter of creating the Home Assistant service.

Enough about how it’s made-- how do I use it?

Warning: I made this in a day during a hack-day at the office, so it’s pretty basic and a little rough around the edges.

Potential contributors: The client library supports the ability for toppings and coupons, but at the moment the Home Assistant component does not. I’m hoping to get around to adding this in, but it’s not super high on my priority list right now. Also, the current process for getting product codes isn’t the most user friendly thing in the world. I’m not exactly a front-end wizard, so if you’d like to make a panel or something to display this instead of the log dump, that would be awesome!

Right now, this isn’t yet in the core Home Assistant install, but there is
a [Pull Request](https://github.com/home-assistant/home-assistant/pull/10379) made, so it should hopefully be available
in the next release, or if you are impatient you can install the library client library via pip (pizzapi) and
then [grab the component from this gist](https://gist.github.com/craigjmidwinter/8548e572b8ee77decd83983e39b887c9) and
add it to your custom components.

To get the component configured, you are going to need to add your information to your configuration.yml like so:

```yaml
    dominos:
      country_code: ca
      first_name: Justin
      last_name: Trudeau
      email: justin.trudeau@parl.gc.ca
      phone: 6139950253
      address: 24 Sussex Dr, Ottawa, ON, K1M1M4
      show_menu: 1
```

If you are wanting to order anything, you are going to need to define some order entities! These are really simple items that live under the orders key. Right now, they just consist of a name and a list of codes, like so:

```yaml
      orders:
      - name: Medium Pan
        codes:
          - P12IPAZA
```

How do you find these order codes? Well, at the moment, it’s not exactly pretty. Currently, the best way to see the codes for the products at your nearest Dominos is to add show_menu: 1 into your config. With that set, when Home Assistant starts and the component loads, you should see a bunch of products and variants in a panel in Home Assistant. The variants represent different sizes and crust choices for the most part. It takes a bit of guesswork in order to decipher what each code represents, but for the most part, you can look at the online menu of your local dominos and compare the offerings.

Or if you are comfortable using a browser’s dev tools, you can do what I did instead and use the Dominos web app to put together an order, and then before you submit the order, turn off your network connection, open up your browser’s dev tools, hit submit and inspect the payload for the order request and have a look at the codes that are sent.

So now that you have your order codes your full config, with your customer information and a few different orders will look like so:

```yaml
    dominos:
      country_code: ca
      first_name: Justin
      last_name: Trudeau
      email: justin.trudeau@parl.gc.ca
      phone: 6139950253
      address: 24 Sussex Dr, Ottawa, ON, K1M1M4
      show_menu: 1
      orders:
      - name: Medium Pan
        codes:
          - P12IPAZA
```

With your config updated, restart Home Assistant and now you should be ready to order pizza in your scripts and automations! Let’s have a look at the one that I set up as an example--

Now, the automation that I have set up is a bit more complex than it needs to be.

If you just want to include a pizza order into a script that you run (for example, if you wanted to be able to be able to trigger a ‘movie night’ script that put your house into movie mode and ordered a pizza), you can just call the service and specify the order entity that you would like to use by adding something like this to the action on your automation and you are done:

```yaml
        - service: dominos.order
          data:
            order_entity_id: dominos.medium_pan
```

I want my pizza order to be event-based, (ie, at a certain time, if I’m the only one home), but I don’t really want it to happen every single time, I’d like to just be prompted and then have the order placed if I confirm it. For this to happen, I need some sort of actionable notification.

I decided to use Telegram for my notification platform for this since it supports actionable notifications using the custom keyboard feature, and it’s available on all the platforms that I use.

In order to accomplish this, I need to actually set up two separate automations (well, I set up three, but the third is not really necessary). Let’s take a look at the first one:

```yaml
    - alias: 'Want pizza?'
      hide_entity: true
      trigger:
        platform: time
        at: '18:30:00'    
      condition:
        - condition: state
          entity_id: device_tracker.craig_craig
          state: 'home'
        - condition: state
          entity_id: device_tracker.jess_iphone
          state: 'not_home'
      action:
        - service: telegram_bot.send_message
          data_template:
            title: 'Want pizza?'
            target: 123456789
            message: 'You look like you are home alone. Should I order you a pizza?'
            disable_notification: true
            inline_keyboard:
              - "Gimme Pizza:/gimmepizza"
              - "No thanks:/nopizza"
```

The first automation triggers at 6:30pm if I am at home and my wife is not_home. She goes to the gym in the evening several times a week at this time and we eat a bit later on those days, so I avoid her being in the not_home state by creating a zone around the gym. When the condition is met, I get a telegram message sent to me that looks like this:
![](https://s3.us-west-2.amazonaws.com/mid-midwinter.cc/images/ryt1RoiAZ.png)
The two options are buttons that basically just send back a command (defined in that inline keyboard bit) that we handle in a callback event. The automation for those callback event looks like this:

```yaml
    - alias: 'No pizza'
      hide_entity: true
      trigger:
        platform: event
        event_type: telegram_callback
        event_data:
          data: '/nopizza'
      action:
        - service: telegram_bot.answer_callback_query
          data_template:
            callback_query_id: '{{ trigger.event.data.id }}'
            message: 'Ok, no pizza then'
    
    - alias: 'gimme pizza'
      hide_entity: true
      trigger:
        platform: event
        event_type: telegram_callback
        event_data:
          data: '/gimmepizza'
      action:
        - service: telegram_bot.answer_callback_query
          data_template:
            callback_query_id: '{{ trigger.event.data.id }}'
            message: 'PIZZA TIME'
        - service: dominos.order
          data:
            order_entity_id: dominos.medium_pan
```

You can see I’ve got one that handles the no response and just gives some user feedback and then one that handles the yes response as well as calls our dominos service and specifies the order.

That inline keyboard is feature is not bound to just two options, so if I had a more adventurous palate, I could have this automation send me a variety of options for orders and let me select which one I want by handling each of the callback responses in a separate automation, but a medium pan pizza is good enough for me.
5:["$","$Ld",null,{"post":{"slug":"2017-11-my-house-automatically-orders-pizza-for-me-dominos-pizza-automation-using-home-assistant","title":"My house automatically orders pizza for me – Dominos Pizza automation using Home Assistant.","date_published":"$D2018-05-04T22:17:00.000Z","date_updated":"$D2018-12-14T03:59:33.000Z","tags":"Home Assistant, YAML, Programming, Dominos, Home Automation, Telegram","cover_image":"","content":"$e"}}]
b:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
9:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Craig Midwinter - Personal Website"}],["$","meta","2",{"name":"description","content":"Welcome to my personal website. Check out my resume, GitHub, LinkedIn, podcast, and blog posts."}],["$","link","3",{"rel":"icon","href":"/craigjmidwinter.github.io/favicon.ico","type":"image/x-icon","sizes":"16x16"}]]
7:null
